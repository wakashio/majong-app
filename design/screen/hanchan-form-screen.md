# 半荘作成・編集画面

## 概要

半荘を作成・編集する画面です。参加者の選択と席順の設定を行います。

## 画面構成

### レイアウト

- ヘッダー: 画面タイトル「半荘作成」または「半荘編集」
- メインコンテンツ:
  - 半荘名入力欄
  - 参加者選択セクション（4人）
  - 席順設定セクション
  - 保存ボタン
  - キャンセルボタン

## 画面項目

### ヘッダー

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 画面タイトル | テキスト | 「半荘作成」または「半荘編集」 |

### 半荘名入力欄

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 半荘名 | テキスト入力 | 半荘の名前（オプション） |

### 参加者選択セクション

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 東 | PlayerSelectButton | 東の席の参加者を選択（`seatPosition = 0`、単一選択、必須） |
| 南 | PlayerSelectButton | 南の席の参加者を選択（`seatPosition = 1`、単一選択、必須） |
| 西 | PlayerSelectButton | 西の席の参加者を選択（`seatPosition = 2`、単一選択、必須） |
| 北 | PlayerSelectButton | 北の席の参加者を選択（`seatPosition = 3`、単一選択、必須） |

### 席順設定セクション

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 席順表示 | テーブル | 参加者と席順の対応を表示 |
| 席順変更ボタン | ボタン | 席順を変更（ドラッグ&ドロップまたは上下ボタン） |

### アクションボタン

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 保存ボタン | ボタン | 半荘を保存 |
| キャンセルボタン | ボタン | 半荘一覧画面に戻る |

## 画面遷移

### 遷移元

- 半荘一覧画面（新規作成ボタンクリック時）
- 半荘一覧画面（編集ボタンクリック時）
- **セッション詳細画面（半荘作成ボタンクリック時）**: `/hanchans/new?sessionId=:sessionId`で遷移

### 遷移先

- 半荘一覧画面（保存成功時、キャンセルボタンクリック時）
- **局入力画面（新規作成時のみ）**: 半荘作成成功後、`/hanchans/:hanchanId/rounds/new?roundNumber=1`に遷移（オプション）
- **セッション詳細画面（セッション詳細画面から遷移した場合）**: 半荘作成成功後、`/sessions/:sessionId`に遷移

## 機能

### 参加者一覧取得

- 画面表示時に`GET /api/players`を呼び出し、参加者一覧を取得
- 取得したデータを`PlayerSelectButton`コンポーネントに表示（ボタン形式）
- **セッション詳細画面から遷移した場合**: URLパラメータ`sessionId`を取得し、`GET /api/sessions/:sessionId`を呼び出してセッション情報を取得
  - セッションの参加者を候補として表示（全参加者から選択可能だが、セッションの参加者を優先表示）
  - セッションIDを`sessionId`として保持

### 半荘作成

- 保存ボタンクリック時にバリデーションを実行
- バリデーション成功後、`POST /api/hanchans`を呼び出し、半荘を作成
  - **セッション詳細画面から遷移した場合**: リクエストボディに`sessionId`を含める
- 作成成功後、以下のいずれかに遷移:
  - **セッション詳細画面から遷移した場合**: セッション詳細画面（`/sessions/:sessionId`）に遷移
  - **半荘一覧画面から遷移した場合**: 局入力画面（`/hanchans/:hanchanId/rounds/new?roundNumber=1`）に遷移（デフォルト動作）
  - **編集時**: 半荘一覧画面に遷移
- エラー時はエラーメッセージを表示

### 半荘編集

- 画面表示時に`GET /api/hanchans/:id`を呼び出し、半荘情報を取得
- 取得したデータをフォームに表示
- 保存ボタンクリック時にバリデーションを実行
- バリデーション成功後、`PUT /api/hanchans/:id`を呼び出し、半荘を更新
- 更新成功後、半荘一覧画面に遷移
- エラー時はエラーメッセージを表示

### バリデーション

- 半荘名は100文字以下
- 参加者は4人選択されている必要がある
- 参加者は重複して選択できない
- 席順は0-3の整数で重複不可
- **セッション詳細画面から遷移した場合**: 選択された参加者がそのセッションの参加者であることを確認（オプション、バリデーション）

### 席順設定

- 参加者選択時に自動的に席順を設定（選択順に0, 1, 2, 3）
  - 東の席（ラベル「東」）: `seatPosition = 0`
  - 南の席（ラベル「南」）: `seatPosition = 1`
  - 西の席（ラベル「西」）: `seatPosition = 2`
  - 北の席（ラベル「北」）: `seatPosition = 3`
- 席順は選択順に自動設定され、手動変更は不要（UI上で「東」「南」「西」「北」の順で選択することで席順が決まる）

## リアルタイム更新

- 参加者の選択・変更時に席順を自動更新
- 保存成功後、半荘一覧画面で一覧を再取得

## UI/UX

### デザイン

- Vuetifyのコンポーネントを使用
- フォームは`v-form`を使用
- **参加者選択**: `PlayerSelectButton`コンポーネントを使用（ボタン形式、`v-chip`を使用したグリッドレイアウト）
  - 4人分の参加者選択（東、南、西、北）を`PlayerSelectButton`で実装
  - `v-select`から`PlayerSelectButton`に変更することで、視覚的に分かりやすく、操作性が向上
- セレクトボックスは`v-select`を使用（その他の選択項目）
- ボタンは`v-btn`を使用

### エラーハンドリング

- バリデーションエラー時は各入力欄の下にエラーメッセージを表示
- APIエラー時は`v-alert`でエラーメッセージを表示
- ネットワークエラー時も適切にエラーメッセージを表示

### ローディング

- データ取得中はローディングインジケーターを表示
- 保存中は保存ボタンを無効化し、ローディングインジケーターを表示

## 実装メモ

- Vue 3 Composition APIを使用
- TypeScriptで型安全性を確保
- 参加者の重複チェックを実装
- 席順の自動設定を実装（選択順に0, 1, 2, 3を自動設定）
- ラベルを「参加者1」「参加者2」から「東」「南」「西」「北」に変更
- 東の席（`seatPosition = 0`）の参加者が最初の親になる（局管理画面で自動設定される）
- **参加者選択UIの変更**: `v-select`から`PlayerSelectButton`コンポーネントに変更
  - ボタン形式（`v-chip`を使用したグリッドレイアウト）で表示
  - 視覚的に分かりやすく、操作性が向上

