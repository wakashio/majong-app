# 局管理画面

## 概要

半荘内の全局をExpansionPanel方式で管理する画面です。各局をExpansionPanelで表示し、展開時に局の編集が可能です。`RoundListView.vue`（局一覧画面）と統合され、1つの画面で全局を管理できます。

## 画面構成

### レイアウト

- ヘッダー: 半荘情報（半荘名、参加者など）
- **ダッシュボードセクション**: 半荘の統計情報を表示（新規追加）
- メインコンテンツ:
  - **ExpansionPanel一覧**: 全局をExpansionPanelで表示
    - 各ExpansionPanelのラベル: 「東1局0本場」形式（例: `東1局0本場`）
    - 各ExpansionPanel内:
      - 局開始フォーム（局番号、風、親、本場、積み棒）
      - 鳴き・リーチ記録コンテナ（常に表示）
        - flexレイアウトで表示（モバイル: 縦並び、デスクトップ: 横並び）
        - 鳴き記録一覧
        - リーチ記録一覧
      - 局終了フォーム（局が開始済みの場合）
      - アクションボタン（保存、次局へ、削除）

## 画面項目

### ヘッダー

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 半荘名 | テキスト | 半荘の名前 |
| 参加者一覧 | テキスト | 参加者の名前（カンマ区切り） |

### ダッシュボードセクション

半荘の進行状況や各参加者のパフォーマンスを一目で把握できるダッシュボードを表示します。

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| ダッシュボードカード | v-card | 統計情報を表示するカード |
| 参加者統計テーブル | v-data-table | 参加者ごとの統計情報をテーブル形式で表示 |
| 統計項目 | テーブル列 | 以下の項目を表示:
  - 参加者名
  - 現在の持ち点（初期得点 + これまでの得点変動の合計）
  - 順位（現在の持ち点順、1-4）
  - 和了回数（ツモ/ロン別）
  - 放銃回数
  - 流局回数 |

#### ダッシュボードの表示内容

各参加者について以下の情報を表示:

1. **参加者名**: 参加者の名前
2. **現在の持ち点**: `initialScore + SUM(scoreChange)`で計算
3. **順位**: 現在の持ち点順（1-4、同点の場合は`seatPosition`で順序を決定）
4. **和了回数**: ツモ回数とロン回数を別々に表示
5. **放銃回数**: ロンの対象になった回数
6. **流局回数**: 流局した回数

#### データ取得

- `GET /api/hanchans/:id/statistics` APIを呼び出して統計情報を取得
- 半荘情報が読み込まれたタイミングで統計情報も取得
- 局が終了したタイミングで統計情報を再取得（リアルタイム更新）

### ExpansionPanel一覧

各局をExpansionPanelで表示します。

#### ExpansionPanelラベル

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| ラベル | テキスト | 「東1局0本場」形式（例: `東1局0本場`） |

#### ExpansionPanel内: 局開始フォーム

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 局番号 | テキスト入力/表示 | 局番号（1-16）、デフォルト値は前の局+1または自動計算 |
| 風 | セレクトボックス | 東/南/西/北、デフォルト値は局番号に応じて自動設定（1-4局: 東、5-8局: 南、など） |
| 親 | セレクトボックス | 親の参加者選択、デフォルト値は以下の通り:
  - **1局目**: 東の席（`seatPosition = 0`）の参加者を自動設定
  - **2局目以降**: 前の局の親を継続（連荘時）または次の席順の人へ（連荘でない場合、東→南→西→北→東の順） |
| 本場 | 数値入力 | 本場数、デフォルト値は前の局から継承（本場の値から連荘かどうかは判断可能） |
| 積み棒 | 数値入力 | 積み棒数、デフォルト値は前の局から継承 |

#### ExpansionPanel内: 鳴き・リーチ記録コンテナ（常に表示）

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 記録コンテナ | カード | 鳴き記録とリーチ記録を統合したカード |
| 記録一覧 | v-list | 鳴き記録とリーチ記録の一覧表示（`density="compact"`でコンパクトに表示） |
| 記録アイテム | v-list-item | 各記録を表示（参加者名、アクションタイプ（鳴き/リーチ）、詳細情報） |
| 削除ボタン | アイコンボタン | `v-list-item`の`append`スロットに配置 |
| 追加ボタン | ボタン | アクション追加ダイアログを表示 |

#### ExpansionPanel内: 打点記録表示（局が終了済みの場合）

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 打点記録一覧 | テーブル | 既存の打点記録の一覧表示（読み取り専用） |
| テーブル列 | 列定義 | 以下の列を表示:
  - 参加者名
  - 点数変動（`scoreChange`、符号付きで表示、正の値は緑色、負の値は赤色）
  - 積み棒（積み棒による点数移動、和了者の場合は`round.riichiSticks × 1000`点、それ以外は0または「-」）
  - 本場（本場による点数移動、親子の判定と結果タイプに応じて計算）
  - テンパイ（テンパイ時の点数移動、流局時にのみ適用、ノーテン罰符の計算）
  - テンパイ状態（テンパイ/ノーテン/「-」） |

##### 打点記録テーブルの表示内容

- **列の構成**:
  - 「飜」「符」のカラムを削除
  - 「積み棒」「本場」の点数移動カラムを追加
- **積み棒の点数移動**（リーチ宣言時の支払いも含む）:
  - リーチ宣言時: リーチ者が支払う（通常のリーチ・ダブルリーチともに`-1000`点）
  - 和了時: 和了者が獲得（`isWinner === true`の場合、`round.riichiSticks × 1000`点）
  - 流局時: リーチ宣言時の支払いのみ表示（積み棒は次局に持ち越されるため、獲得は0）
  - 流し満貫時: 流し満貫を達成した参加者が獲得（`round.riichiSticks × 1000`点）+ リーチ宣言時の支払い
  - ダブロン: 放銃者から見て最も近い上家のみが獲得（実装は別タスク、現時点では通常のロンのみ対応）
- **本場の点数移動**:
  - 親がツモ: 子は`-round.honba × 300`点
  - 子がツモ: 親は`-round.honba × 300`点、子は`-round.honba × 100`点
  - 親がロン: 放銃者は`-round.honba × 300`点
  - 子がロン（親から）: 放銃者（親）は`-round.honba × 300`点
  - 子がロン（子から）: 放銃者（子）は`-round.honba × 100`点
  - 流局時: 0または「-」を表示
  - 流し満貫時: 0または「-」を表示
  - ダブロン: 放銃者から見て最も近い上家のみが本場の点数を受け取る（実装は別タスク、現時点では通常のロンのみ対応）
- **計算方法**:
  - **Scoreから直接値を取得して表示する**（フロントエンドでの算出ロジックを削除）
  - フロントエンドの算出ロジック（`calculateRiichiSticksScoreChange`、`calculateScoreChangeWithRiichi`、`calculateHonbaScoreChange`）を削除
  - `getDisplayScores`関数を修正（リーチ記録があるがScoreが存在しない参加者について仮想的なScoreを作成する処理を削除）
  - **局終了前は打点記録テーブルを表示しない、または空の状態で表示する**（局終了時に一括で計算するため、局終了前はScoreが存在しない）
- **テンパイ時の点数移動**:
  - 流局時のみ適用（通常の流局・特殊流局）
  - ノーテン罰符の計算（親子の区別なし）:
    - ノーテン罰符として場に3,000点を供託し、テンパイ者で均等に分配する
    - テンパイ者が1人の場合: ノーテン者3人が各`-1000`点ずつ支払い、テンパイ者が`+3000`点を受け取る
    - テンパイ者が2人の場合: ノーテン者2人が各`-1500`点ずつ支払い、テンパイ者2人が各`+1500`点ずつ受け取る
    - テンパイ者が3人の場合: ノーテン者1人が`-3000`点を支払い、テンパイ者3人が各`+1000`点ずつ受け取る
    - 全員ノーテンの場合: ノーテン罰符の支払いは発生しない（0点）
    - 全員テンパイの場合: ノーテン罰符の支払いは発生しない（0点）
  - ツモ・ロン時: 0または「-」を表示
  - 流し満貫時: 0または「-」を表示
  - 計算方法:
    - 各参加者の`isTenpai`情報を使用
    - テンパイ者の数とノーテン者の数に応じて分配を計算
    - 親子の判定（`isDealer`）は使用しない（ノーテン罰符は親子の区別なし）

#### 結果入力ダイアログ（局が開始済みの場合）

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| ダイアログ | v-dialog | 結果入力用のダイアログ（「局を終了」ボタンクリック時に表示） |
| 結果タイプ選択 | ボタングループ | ツモ/ロン/流局/流し満貫/特殊流局をボタン形式で選択（v-btn-toggleまたはv-btnのグループ） |
| 特殊流局タイプ選択 | ボタングループ/セレクトボックス | 四槓/四風/九種九牌（結果タイプが特殊流局の場合、ボタン形式またはv-select） |
| 和了者選択セクション | v-chip-group | ツモ・ロン選択時に表示、和了者をチップ形式で選択<br>ツモ: mandatory、single selection（1人のみ）<br>ロン: multiple selection（1〜3人、ダブロン・トリロン対応） |
| 放銃者選択セクション | v-chip-group | ロン選択時に表示、放銃者をチップ形式で選択<br>mandatory、single selection（1人のみ） |
| 点数入力セクション | 入力コンテナ | 和了者選択後に点数・飜・符の入力欄を表示<br>v-cardを削除し、シンプルな入力欄に変更 |
| 点数入力欄 | 数値入力 | 必須、`scoreChange`（デフォルト値: 0） |
| 飜入力欄 | 数値入力 | 任意、`han`（自摸上がりの場合、入力時に自動計算をトリガー） |
| 符入力欄 | 数値入力 | 任意、`fu`（自摸上がりの場合、入力時に自動計算をトリガー） |
| キャンセルボタン | ボタン | ダイアログを閉じる |
| 確定ボタン | ボタン | 結果入力を確定し、局を終了する |

##### スコア入力セクションのコンパクト化

- **参加者カードのコンパクト化**:
  - `v-card`に`variant="outlined"`を設定してボーダーのみ表示
  - `v-card-title`のクラスを`text-subtitle-2`から`text-body-2`に変更（フォントサイズ縮小）
  - `v-card-text`のパディングを削減（`pa-2`など）
  - レイアウト: `v-row/v-col`で2列表示（`md="6"`）を維持

##### 点数のデフォルト値

- **初期化時のデフォルト値**:
  - `scoreChange: null` → `scoreChange: 0`に変更
  - `openResultDialog`関数と`initializeScoreInputsForRound`関数で初期化時に`scoreChange: 0`を設定
  - エラーメッセージの条件を`scoreChange === null || scoreChange === undefined`から`scoreChange === null || scoreChange === undefined || scoreChange === 0`に変更（または0を許可）

##### 自摸上がりの自動計算機能

- **自動計算のトリガー**:
  - 結果タイプが`TSUMO`の場合に自動計算を有効化
  - 和了者の点数入力時（`v-text-field`の`@input`イベント）に自動計算
  - 飜入力時（`v-text-field`の`@input`イベント）に自動計算
  - 符入力時（`v-text-field`の`@input`イベント）に自動計算

- **自動計算の実装**:
  - `POST /api/rounds/:id/calculate-score` APIを呼び出して点数を計算
  - 計算条件: 和了者の点数、飜、符、親子判定（`isDealer`）、本場（`honba`）、積み棒（`riichiSticks`）
  - 計算結果を他の3人の`scoreChange`に自動入力（手動変更可能）
  - 和了者の`scoreChange`は入力値を使用（計算結果で上書きしない）

- **自動計算の処理フロー**:
  1. 和了者が選択されていることを確認
  2. 和了者の点数、飜、符が入力されていることを確認
  3. `calculateScore` APIを呼び出し（`resultType: "TSUMO"`, `winnerPlayerId`, `han`, `fu`を指定）
  4. APIレスポンスから各参加者の`scoreChange`を取得
  5. 和了者以外の3人の`scoreChange`を自動入力（和了者の`scoreChange`は入力値を維持）

#### アクション追加ダイアログ

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| ダイアログ | v-dialog | アクション記録追加用のダイアログ（「追加」ボタンクリック時に表示） |
| アクションタイプ選択 | PlayerSelectButton | アクションタイプをボタン形式で選択（単一選択、必須）<br>選択肢: 鳴き、リーチ |
| 参加者選択 | PlayerSelectButton | 参加者をボタン形式で選択（単一選択、必須） |
| **鳴きの場合（アクションタイプ=鳴き）:** | | |
| 鳴きタイプ選択 | PlayerSelectButton | 鳴きタイプをボタン形式で選択（単一選択、必須）<br>選択肢: ポン、チー、大明槓、暗槓 |
| 対象参加者選択 | PlayerSelectButton | 対象参加者をボタン形式で選択（単一選択、暗槓以外の場合のみ表示、必須） |
| 牌入力欄 | テキスト入力 | 牌（カンマ区切り、例: `1m,1m,1m`、必須） |
| **リーチの場合（アクションタイプ=リーチ）:** | | |
| （追加フィールドなし） | | |
| キャンセルボタン | ボタン | ダイアログを閉じる |
| 追加ボタン | ボタン | アクション記録を追加する |

#### ExpansionPanel内: アクションボタン

| 項目名 | タイプ | 説明 |
|--------|--------|------|
| 保存ボタン | ボタン | 局情報を保存（局開始情報、局進行中記録） |
| 局を終了ボタン | ボタン | 結果入力ダイアログを表示（局が開始済みで未終了の場合） |
| 次局へボタン | ボタン | 局保存成功後、次の局のExpansionPanelを自動展開（確認ダイアログ表示） |
| 削除ボタン | ボタン | 局を削除（確認ダイアログ表示） |

## 画面遷移

### 遷移元

- 半荘一覧画面（半荘を選択した時、`/hanchans/:hanchanId/rounds`）
- 半荘作成画面（新規作成成功時、`/hanchans/:hanchanId/rounds`）

### 遷移先

- 半荘一覧画面（キャンセルボタンクリック時、`/hanchans`）

## 機能

### 全局一覧取得

- 画面表示時に`GET /api/hanchans/:hanchanId/rounds`を呼び出し、全局一覧を取得
- 取得したデータをExpansionPanelで表示
- エラー時はエラーメッセージを表示

### 局開始

- 局基本情報を入力（デフォルト値が自動設定される）
  - 局番号: 前の局+1（または自動計算）
  - 風: 局番号に応じて自動設定（1-4局: 東、5-8局: 南、9-12局: 西、13-16局: 北）
  - 親: 以下のルールで自動設定
    - **1局目**: 東の席（`seatPosition = 0`）の参加者を自動設定
      - `hanchan.hanchanPlayers`から`seatPosition = 0`の参加者を取得
      - 取得した参加者の`playerId`を`dealerPlayerId`に設定
    - **2局目以降**: 前の局の親を継続（連荘時）または次の席順の人へ（連荘でない場合、東→南→西→北→東の順）
      - 前の局の親の`seatPosition`を取得
      - 連荘でない場合: `(seatPosition + 1) % 4`で次の席順を計算
      - 連荘の場合: 前の局の親を継続
    - **エラーハンドリング**: 
      - `hanchan.hanchanPlayers`が空の場合、エラーメッセージを表示し、親を設定しない
      - `seatPosition = 0`の参加者が見つからない場合、エラーメッセージを表示し、親を設定しない
      - `loadHanchan()`がエラーを返した場合、デフォルト値の自動設定を実行しない
  - 本場・積み棒: 前の局から継承
  - 連荘: チェックボックスを削除（本場の値から連荘かどうかは判断可能なため、表示不要）
- 保存ボタンクリック時に`POST /api/hanchans/:hanchanId/rounds`を呼び出し、局を作成
- 作成成功後、局の`startedAt`を更新（`PUT /api/rounds/:id`）
- エラー時はエラーメッセージを表示

### 局進行中

- アクション記録追加（鳴きまたはリーチ）: 
  - 局が未作成（`!round.createdAt`）の場合:
    - 親（`dealerPlayerId`）が未設定の場合はエラーメッセージを表示
    - 親が設定されている場合、先に局を作成（`POST /api/hanchans/:hanchanId/rounds`）
    - 局作成成功後、作成された局IDでアクションを記録（`POST /api/rounds/:id/actions`）
  - 局が作成済み（`round.createdAt`が存在）の場合:
    - `POST /api/rounds/:id/actions`を呼び出し、アクションを記録
    - リクエストボディで`type`を指定して、鳴き（`NAKI`）かリーチ（`RIICHI`）かを区別
- 局情報更新: `PUT /api/rounds/:id`を呼び出し、局情報を更新

### 局終了

- 「局を終了」ボタンクリック時に結果入力ダイアログを表示
- ダイアログ内で結果タイプをボタン形式で選択（v-btn-toggleまたはv-btnのグループ）
  - ツモ/ロン/流局/流し満貫/特殊流局
- 結果タイプに応じて条件分岐表示:
  - **ツモ・ロン選択時**: スコア入力セクションを表示
    - 和了者選択セクション（v-chip-group）:
      - ツモ: mandatory、single selection（1人のみ）
      - ロン: multiple selection（1〜3人、ダブロン・トリロン対応）
      - テンパイ入力セクション（384-414行目）と同様のUIパターン
    - 放銃者選択セクション（v-chip-group、ロン時のみ）:
      - mandatory、single selection（1人のみ）
      - テンパイ入力セクションと同様のUIパターン
    - 点数入力セクション:
      - v-cardを削除し、シンプルな入力欄に変更
      - 和了者選択後に点数・飜・符の入力欄を表示
      - ツモ時: 和了者の点数・飜・符を入力すると他家の点数を自動計算（`handleScoreInputChange`関数を維持）
      - ロン時: 各和了者の点数・飜・符を個別に入力
    - バリデーション:
      - ツモ: 和了者が1人
      - ロン: 和了者が1〜3人、放銃者が1人
  - **特殊流局選択時**: 特殊流局タイプ選択を表示（ボタン形式またはv-select）
    - 四槓/四風/九種九牌
- ダイアログのアクション:
  - [キャンセル]: ダイアログを閉じる
  - [確定]: 結果入力を確定し、`PUT /api/rounds/:id/end`を呼び出して局を終了
- 確定成功後、確認ダイアログを表示:
  - 「次局へ」: 次の局のExpansionPanelを自動展開
  - 「キャンセル」: ダイアログを閉じる
- エラー時はエラーメッセージを表示

### 次の局への遷移

- 局保存成功後、「次局へ」ボタンで確認ダイアログを表示
- 確認ダイアログで「次局へ」を選択すると、`POST /api/rounds/:id/calculate-next-settings`を呼び出して次局の設定を計算
  - **リクエストパラメータ**:
    - `resultType`: 局の結果タイプ（必須）
    - `winnerPlayerId`: 和了者のID（ツモ・ロンの場合のみ必須）
    - `isDealerTenpai`: 親がテンパイしているかどうか（流局時のみ）
      - `roundScores`から親のスコア情報を取得し、`isTenpai`の値を取得
      - 親のスコア情報: `roundScores.find(score => score.isDealer)`
      - `isDealerTenpai = score.isTenpai === true`（`isTenpai`が`true`の場合のみ`true`、それ以外は`undefined`）
- 計算結果（`nextRoundNumber`、`nextWind`、`nextHonba`、`nextRiichiSticks`、`isRenchan`）を取得
- 次の局のExpansionPanelを自動展開
- 次の局が存在しない場合は新規作成（**`POST /api/hanchans/:hanchanId/rounds`を呼び出して局を作成**）
  - **実装方針**:
    - `handleNextRoundFromPanel`関数で、次局オブジェクトをローカルで作成する処理（1559-1581行目）を削除
    - `calculateNextSettings` APIで計算した次局の設定（局番号、風、本場、積み棒、連荘）と次局の親情報を使用して`CreateRoundRequest`を作成
    - **次局の親の判定**:
      - `isRenchan`フラグを使用して連荘を判定（局番号の比較ではなく、`isRenchan`フラグを使用）
      - `isRenchan === true`の場合: 前の局の親を継続（`round.dealerPlayerId`を使用）
      - `isRenchan === false`の場合: 次の席順の人へ（`(lastDealerIndex + 1) % 4`で計算）
    - `createRound` APIを呼び出して局を作成（`handleAddAction`関数（1196-1217行目）のパターンを参考）
    - APIの結果を受け取って、`rounds.value.push(createResult.data)`で追加
    - エラーハンドリングを追加（`"error" in createResult`の場合にエラーメッセージを表示）
    - 局作成成功後、作成された局のExpansionPanelを自動展開
- 展開されたExpansionPanel内の入力欄に計算結果が自動入力される

### 局削除

- 削除ボタンクリック時に確認ダイアログを表示
- 確認後、`DELETE /api/rounds/:id`を呼び出し、局を削除
- 削除成功後、一覧を再取得
- エラー時はエラーメッセージを表示

### バリデーション

- 局番号は1-16の範囲
- 風は東/南/西/北のいずれか
- 親は半荘に参加している参加者
- 本場、積み棒は0以上
- 結果タイプが`SPECIAL_DRAW`の場合、特殊流局タイプが必須
- 結果タイプが`TSUMO`または`RON`の場合、スコア入力フォームが必須
  - ツモ: 和了者が1人、点数必須、飜・符は任意
  - ロン: 和了者が1〜3人、放銃者が1人、点数必須、飜・符は任意

## リアルタイム更新

- 局の作成・更新・削除後、一覧を自動更新
- 局の進行中に記録が追加された場合、リアルタイムで表示を更新

## UI/UX

### デザイン

- Vuetifyのコンポーネントを使用
- ExpansionPanelは`v-expansion-panels`と`v-expansion-panel`を使用
- フォームは`v-form`を使用
- **参加者・鳴きタイプ選択**: `PlayerSelectButton`コンポーネントを使用（ボタン形式、`v-chip`を使用したグリッドレイアウト）
  - 鳴き追加ダイアログ: 参加者選択、対象参加者選択、鳴きタイプ選択
  - リーチ追加ダイアログ: 参加者選択
  - 親選択: 参加者選択（将来的に手動選択が必要になった場合に適用）
- セレクトボックスは`v-select`を使用（その他の選択項目）
- 鳴き・リーチ記録一覧は`v-list`を使用（`density="compact"`でコンパクトに表示）
- テーブルは`v-data-table`を使用（打点記録など）
- ボタンは`v-btn`を使用
- ダイアログは`v-dialog`を使用（結果入力ダイアログ、鳴き追加ダイアログ、リーチ追加ダイアログ）
- 結果タイプ選択は`v-btn-toggle`または`v-btn`のグループを使用（ボタン形式）
- 和了者・放銃者選択は`v-chip-group`を使用（テンパイ入力セクションと同様のUIパターン）
- 点数入力はシンプルな入力欄（v-text-field）を使用（v-cardを削除）
- **最新の局へスクロールボタン**: フローティングボタン（`v-btn`の`fab`プロパティ）を使用
  - 配置: 画面右上に固定（`position: fixed; top: 16px; right: 16px;`）
  - アイコン: `mdi-arrow-down`または`mdi-chevron-double-down`を使用
  - ツールチップ: 「最新の局へスクロール」を表示
  - 表示条件: 局が2つ以上ある場合のみ表示（`sortedRounds.length >= 2`）
  - スクロール先: 局番号が最大の局（`sortedRounds`の最後の要素）
  - スクロール実装: `scrollIntoView()`を使用して該当の`v-expansion-panel`までスクロール
  - 展開処理: 必要に応じて`expandedPanels`に該当局のIDを追加して展開する

### レスポンシブレイアウト

#### 鳴き・リーチ記録のflexレイアウト

- 鳴き記録とリーチ記録はflexコンテナ（`<div class="records-container">`）で囲む
- モバイル表示（600px以下）:
  - `flex-direction: column`（縦並び）
  - 鳴き記録カードとリーチ記録カードが縦に並ぶ
- デスクトップ表示（600px以上）:
  - `flex-direction: row`（横並び）
  - 鳴き記録カードとリーチ記録カードが横に並ぶ
- `@media`クエリを使用してレスポンシブ対応を実装
- gapプロパティで適切な間隔を設定
- 鳴き・リーチ記録はv-listで表示（v-data-tableから変更）

### ExpansionPanelの表示

- 全局をExpansionPanelで表示
- 各ExpansionPanelのラベルは「東1局0本場」形式（例: `東1局0本場`）
- 局の状態（開始済み/未開始）はUI上は表示しない（状態管理は不要）
- 複数のExpansionPanelを同時に展開可能

### エラーハンドリング

- バリデーションエラー時は各入力欄の下にエラーメッセージを表示
- APIエラー時は`v-alert`でエラーメッセージを表示
- ネットワークエラー時も適切にエラーメッセージを表示

### ローディング

- データ取得中はローディングインジケーターを表示
- 保存中は保存ボタンを無効化し、ローディングインジケーターを表示

## 実装メモ

- Vue 3 Composition APIを使用
- TypeScriptで型安全性を確保
- **ExpansionPanel方式**: 全局をExpansionPanelで表示し、展開時に局の編集が可能
- 「局開始」「局進行中」「局終了」のタブは削除（各ExpansionPanel内に全ての情報を表示）
- デフォルト値の自動設定ロジックを実装:
  - 局番号: 前の局+1（または自動計算）
  - 風: 局番号に応じて自動設定
  - 親: 以下のルールで自動設定
    - **1局目**: 東の席（`seatPosition = 0`）の参加者を自動設定
      - `hanchan.hanchanPlayers`から`seatPosition = 0`の参加者を取得
      - 取得した参加者の`playerId`を`dealerPlayerId`に設定
      - `loadRounds`関数で最初の局を作成する際に、`initializeRoundEditData`関数内で自動設定
    - **2局目以降**: 前の局の親を継続（連荘時）または次の席順の人へ（連荘でない場合、東→南→西→北→東の順）
      - 前の局の親の`seatPosition`を取得
      - 連荘でない場合: `(seatPosition + 1) % 4`で次の席順を計算
      - 連荘の場合: 前の局の親を継続
  - 本場・積み棒: 前の局から継承
  - 連荘: チェックボックスを削除（本場の値から連荘かどうかは判断可能なため、表示不要）
    - `roundEditData`の型定義から`isRenchan`を削除
    - 局作成・更新時に`isRenchan`を送信する処理を確認し、必要に応じて修正
  - **エラーハンドリング**:
    - `setDefaultValues`内で`players.value`を使用する前に、`players.value.length > 0`を確認する
    - `loadHanchan()`がエラーを返した場合、`setDefaultValues`を実行しない
    - `players.value`が空の場合、エラーメッセージを表示する（例: "参加者情報を取得できませんでした"）
    - `seatPosition = 0`の参加者が見つからない場合、エラーメッセージを表示する（例: "東の席の参加者が見つかりませんでした"）
- 鳴き・リーチ記録の追加はダイアログで実装
- **鳴き・リーチ記録追加ダイアログの選択UI**: `PlayerSelectButton`コンポーネントを使用（ボタン形式）
  - 鳴き追加ダイアログ: 参加者選択、対象参加者選択、鳴きタイプ選択を`PlayerSelectButton`に変更
  - リーチ追加ダイアログ: 参加者選択を`PlayerSelectButton`に変更
  - `v-select`から`PlayerSelectButton`に変更することで、視覚的に分かりやすく、操作性が向上
- **鳴き・リーチ記録の表示条件**: `round.createdAt`の判定を削除し、常に表示する
  - 記録時に局が未作成（`!round.createdAt`）の場合は、先に局を作成してから記録
  - 局作成には親（`dealerPlayerId`）が必要なため、親が未設定の場合はエラーメッセージを表示
- **鳴き・リーチ記録の表示方法**: v-listを使用（v-data-tableから変更）
  - `density="compact"`でコンパクトに表示
  - 鳴き記録: 参加者名、鳴きタイプ、対象参加者名（あれば）を`v-list-item`で表示
  - リーチ記録: 参加者名、ダブルリーチ（あれば）、一発（あれば）を`v-list-item`で表示
  - 削除ボタンは`v-list-item`の`append`スロットに配置
- **局終了時の結果入力方法**: ダイアログ形式に統一（鳴き・リーチ記録と同様のUI/UX）
  - 「局を終了」ボタンクリック時に結果入力ダイアログを表示
  - 結果タイプはボタン形式（v-btn-toggleまたはv-btnのグループ）で選択
  - 和了者選択をチップ形式（v-chip-group）で選択（ツモ: 1人のみ、ロン: 1〜3人）
  - 放銃者選択をチップ形式（v-chip-group）で選択（ロン時のみ、1人のみ）
  - 点数入力はシンプルな入力欄（v-text-field）で入力（v-cardを削除）
  - 1つのダイアログ内で条件分岐表示（結果タイプに応じてスコア入力セクションまたは特殊流局タイプ選択を表示）
  - 既存の結果入力フォーム（v-select + v-data-table）は削除
  - 既存の打点記録表示（読み取り専用）は維持
- 次の局への自動展開機能を実装
- 確認ダイアログで「次局へ」「キャンセル」を選択可能
- リアルタイム更新は必要に応じて実装（現時点では手動更新）
- `RoundListView.vue`（局一覧画面）は削除し、この画面に統合
- ルーティングは`/hanchans/:hanchanId/rounds`に統合
- **局のラベル表示の修正（TASK-20260101-001）**:
  - `getRoundLabel`関数が局番号をそのまま表示している不具合を修正
  - 局番号から風内での局番号を計算する必要がある
  - 計算式: 風内局番号 = `((roundNumber - 1) % 4) + 1`
  - 例: 局番号5 → 風内局番号1 → 「南1局」、局番号6 → 風内局番号2 → 「南2局」
  - `getRoundLabel`関数内で局番号から風内局番号を計算する関数を追加
  - `getRoundLabel`関数を使用しているすべての箇所で正しく表示されることを確認
  - 影響範囲: `getRoundLabel`関数（610-613行目）と`getRoundLabelWithDealerAndSticks`関数（616-634行目）
