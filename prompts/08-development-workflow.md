# 開発フロー

## 開発手順

### 1. 既存ロジック確認（重複回避）

新規機能を実装する前に、既存のコードベースを確認します。

```bash
# 既存のコードを検索
grep -r "類似の機能名" src/
# または
codebase_search "類似の機能について"
```

**確認ポイント:**
- 同じ機能が既に実装されていないか
- 再利用可能な既存の関数がないか
- 類似のパターンがないか

### 2. 実装

既存ロジックを確認した上で実装を開始します。

**実装時の注意点:**
- コーディング規約に従う（`03-coding-standards.md`参照）
- 型定義を適切に使用
- エラーハンドリングを実装
- コメントを適切に記述
- **バックエンドの実装にはTDD（テスト駆動開発）を推奨**
  - テストコードを先に作成（`07-testing-strategy.md`参照）
  - その後、実装コードを作成してテストが通ることを確認

### 3. テスト作成・実行（バックエンド必須）

**テストコードの実装タイミング:**
- バックエンドの実装にはTDDを推奨（実装フェーズでテストコードを先に作成）
- テストコードは実装コードと同時に、または実装コードの前に作成する

**テスト実行:**
```bash
cd backend
npm test
```

**テスト作成のポイント:**
- 正常系のテスト
- 異常系のテスト
- エッジケースのテスト

### 4. lint実行・修正

コード修正後は必ずlintを実行し、エラーを修正します。

```bash
# バックエンド
cd backend
npm run lint
npm run lint:fix  # 自動修正可能な場合は自動修正

# フロントエンド（将来設定時）
cd frontend
npm run lint
```

**lintエラーは必ず修正:**
- 警告も可能な限り修正
- 自動修正できない場合は手動で修正

### 5. 影響範囲確認

コードを修正する際は、影響範囲を特定してから修正します。

**確認ポイント:**
- 修正した関数を使用している箇所
- 型定義の変更による影響
- テストの修正が必要か

### 6. 参照の更新確認（ファイル名・コマンド名変更時）

ファイル名やコマンド名を変更した場合は、他のファイルへの参照も更新する必要があります。

**確認手順:**

1. **変更したファイル名/コマンド名を検索**
   ```bash
   # ファイル名の検索
   grep -r "old-filename.md" prompts/ .cursor/
   
   # コマンド名の検索
   grep -r "/old-command" .cursor/ prompts/
   ```

2. **参照箇所を特定**
   - `prompts/`ディレクトリ内の他のファイル
   - `.cursor/commands/`ディレクトリ内のファイル
   - READMEファイル
   - その他のドキュメント

3. **参照を更新**
   - ファイル名の参照を新しい名前に更新
   - コマンド名の参照を新しい名前に更新
   - パスの参照を更新

4. **lint実行で確認**
   ```bash
   # lintを実行してエラーがないか確認
   read_lints paths: ['prompts', '.cursor']
   ```

**例: ファイル名変更時**
- `00-project-overview.md` → `01-project-overview.md`に変更した場合
- `prompts/00-ai-workflow.md`内の`00-project-overview.md`への参照を`01-project-overview.md`に更新

**例: コマンド名変更時**
- `idea.md`の内容を変更した場合
- `/idea`コマンドへの参照を確認
- コマンドの説明文も更新

## ブランチ戦略

現在は未定義です。将来的に以下のような戦略を検討します。

- `main`: 本番環境用ブランチ
- `develop`: 開発用ブランチ
- `feature/*`: 機能追加用ブランチ
- `fix/*`: バグ修正用ブランチ

## コミット規約

現在は未定義です。将来的に以下のような規約を検討します。

```
<type>: <subject>

<body>

<footer>
```

**typeの例:**
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `test`: テスト
- `refactor`: リファクタリング

## lint実行

### バックエンド

```bash
cd backend
npm run lint        # lintチェック
npm run lint:fix    # 自動修正
```

**設定ファイル:**
- ESLint設定（将来追加時）

### フロントエンド

現在は未設定です。将来的にESLintやPrettierの導入を検討します。

## コードレビューのポイント

### 1. 影響範囲の確認

- 修正したコードが他の部分に影響を与えていないか
- 型定義の変更が適切か
- テストが適切に修正されているか

### 2. テストの確認

- バックエンドの新規機能にテストが作成されているか
- 既存のテストが適切に修正されているか
- テストがすべて通るか

### 3. コーディング規約の遵守

- 命名規則に従っているか
- 型定義が適切か
- コメントが適切に記述されているか
- 全角記号が使用されていないか

### 4. パフォーマンス

- 不要な再レンダリングがないか
- メモリリークの可能性がないか
- 適切な最適化が行われているか

## 開発環境のセットアップ

### 初回セットアップ

```bash
# フロントエンド
cd frontend
npm install

# バックエンド
cd backend
npm install
```

### 開発サーバーの起動

```bash
# フロントエンド
cd frontend
npm run dev
# http://localhost:5173 でアクセス

# バックエンド
cd backend
npm run dev
```

## ビルド

### フロントエンド

```bash
cd frontend
npm run build
```

ビルド結果は`frontend/dist/`に出力されます。

### バックエンド

```bash
cd backend
npm run build
```

ビルド結果は`backend/dist/`に出力されます。

## デバッグ

### フロントエンド

- ブラウザの開発者ツールを使用
- Vue DevToolsを使用（推奨）
- `console.log`でデバッグ（本番環境では削除）

### バックエンド

- Node.jsのデバッガーを使用
- `console.log`でデバッグ（本番環境では削除）
- ログライブラリの導入を検討（将来）

## よくある作業フロー

### 新機能追加

1. 要件確認
2. 既存ロジック確認
3. 型定義追加（`types/`）
4. 実装
5. テスト作成（バックエンド）
6. lint実行・修正
7. 動作確認

### バグ修正

1. バグの再現
2. 原因の特定
3. 影響範囲の確認
4. 修正
5. テスト修正（必要に応じて）
6. lint実行・修正
7. 動作確認

### リファクタリング

1. リファクタリング対象の特定
2. テストの確認（既存テストが通ることを確認）
3. リファクタリング実行
4. テスト実行（すべて通ることを確認）
5. lint実行・修正
6. 動作確認

### ファイル名・コマンド名の変更

1. **変更前の参照を検索**
   ```bash
   # ファイル名の検索
   grep -r "old-filename.md" prompts/ .cursor/ README.md
   
   # コマンド名の検索
   grep -r "/old-command" .cursor/ prompts/ README.md
   ```

2. **ファイル名/コマンド名を変更**
   - ファイルのリネームまたは内容の更新

3. **参照を更新**
   - 検索結果に基づいて、すべての参照箇所を更新
   - `prompts/`ディレクトリ内のファイル
   - `.cursor/commands/`ディレクトリ内のファイル
   - `README.md`などのドキュメント

4. **lint実行・確認**
   ```bash
   read_lints paths: ['prompts', '.cursor']
   ```

5. **最終確認**
   - すべての参照が正しく更新されているか確認
   - 変更したファイルが正しく動作するか確認

## トラブルシューティング

### 依存関係のエラー

```bash
# node_modulesを削除して再インストール
rm -rf node_modules package-lock.json
npm install
```

### TypeScriptのエラー

- `tsconfig.json`の設定を確認
- 型定義が適切か確認
- インポートパスが正しいか確認

### lintエラー

- 自動修正可能な場合は`npm run lint:fix`を実行
- 手動で修正が必要な場合はエラーメッセージを確認して修正

